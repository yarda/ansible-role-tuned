---
- name: Install Tuned
  package: name=tuned state=latest

- name: Enable Tuned
  service: name=tuned state=started enabled=yes

- name: Check Tuned version
  command: tuned-adm recommend
    register: result
    ignore_errors: true

- set_fact:
    tuned_legacy: {{ (result | succeeded) | ternary(true, false) }}
    when: result | succeeded

- name: Set Tuned profile {{ tuned_profile }}
  command: tuned-adm profile {{ tuned_profile }}
